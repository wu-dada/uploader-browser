!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["uploader-browser"]=e():t["uploader-browser"]=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),o=n(1),i=n(4),u=n(5),s=n(6),a=n(7),c=n(9),f=function(){function t(t){var e=this;this.next=function(t){},this.complete=function(t){},this.error=function(t){},this.uploadUrl=t.url,this.file=t.file,this.uuid=c.guid(),this.status=o.STATUS.QUEUED,this.retryCount=0,this.aborted=!1,this.xhrList=[],this.xhrHandler=function(t){return e.xhrList.push(t)},this.config=a.extend({},r.default.config,t.config),this.putExtra=a.extend({},r.default.putExtra,t.putExtra),this.debug=new u.default(t.debug),this.debug.log("Config",t)}return Object.defineProperty(t.prototype,"progress",{set:function(t){this._progress=t,this.next(t)},enumerable:!0,configurable:!0}),t.prototype.start=function(){var t=this;this.aborted=!1,this.status=o.STATUS.STARTED,this.putExtra.fname||(this.putExtra.fname=this.file.name);var e=this.config.forceDirect||this.file.size>this.config.chunkSize?this.chunkUpload():this.directUpload();return e.then((function(e){t.complete(e),t.status=o.STATUS.DONE})).catch((function(e){t.aborted||(t.status=o.STATUS.FAILED,t.clear(),++t.retryCount<=t.config.retryCount&&!t.aborted?t.start():t.error(e))})),e},t.prototype.clear=function(){this.xhrList.forEach((function(t){return t.abort()})),this.xhrList=[]},t.prototype.stop=function(){this.clear(),this.aborted=!0,this.status=o.STATUS.STOPPED},t.prototype.reset=function(){c.removeLocalFileInfo(this.file)},t.prototype.chunkUpload=function(){var t=this;this.uploaded=c.getLocalFileInfo(this.file),this.chunks=c.getChunks(this.file,this.config.chunkSize),this.chunksLoaded=this.chunks.map((function(t){return{loaded:0,total:0}}));var e=this.chunks.length,n=new i.default((function(e){return t.chunkSend(e)}),this.config.concurrentLimit),r=this.chunks.map((function(t,r){return n.enqueue({chunk:t,index:r,length:e})}));return Promise.all(r).then((function(e){return c.removeLocalFileInfo(t.file),e[e.length-1]}))},t.prototype.chunkSend=function(t){var e=this,n=t.chunk,r=t.index,o=t.length,i=this.uploaded[r];if(i&&!c.isChunkExpired(i.time)){var u={loaded:i.loaded,total:i.loaded};return this.updateChunkProgress(u,r),i.before=!0,Promise.resolve(i)}var f=new FormData,l={file:n,uuid:this.uuid,name:this.putExtra.fname,chunk:r,chunks:o};return a.filterParams(l).forEach((function(t){return f.append(t[0],t[1])})),this.putExtra.params&&a.filterParams(this.putExtra.params).forEach((function(t){return f.append(t[0],t[1])})),s.default(this.uploadUrl,{method:"POST",body:f,onCreate:this.xhrHandler,onProgress:function(t){return e.updateChunkProgress(t,r)}}).then((function(t){return e.uploaded[r]={time:(new Date).getTime(),loaded:n.size,before:!1,res:t.data},c.setLocalFileInfo(e.file,e.uploaded),t}))},t.prototype.updateChunkProgress=function(t,e){this.chunksLoaded[e]=t;var n=this.chunksLoaded.reduce((function(t,e){return t+e.loaded}),0);this.progress={total:c.getPercent(n,Math.max(n,this.file.size)),chunks:this.chunksLoaded.map((function(t){return c.getPercent(t.loaded,t.total)}))}},t.prototype.directUpload=function(){var t=this,e=new FormData,n={file:this.file,uuid:this.uuid,name:this.putExtra.fname};return a.filterParams(n).forEach((function(t){return e.append(t[0],t[1])})),this.putExtra.params&&a.filterParams(this.putExtra.params).forEach((function(t){return e.append(t[0],t[1])})),s.default(this.uploadUrl,{method:"POST",body:e,onProgress:function(e){return t.updateDirectProgress(e)},onCreate:this.xhrHandler})},t.prototype.updateDirectProgress=function(t){var e=t.loaded,n=t.total;this.progress={total:c.getPercent(e,++n)}},t}();e.default=f},function(t,e,n){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.QUEUED=0]="QUEUED",t[t.STARTED=1]="STARTED",t[t.STOPPED=2]="STOPPED",t[t.DONE=3]="DONE",t[t.FAILED=4]="FAILED",t[t.PAUSED=5]="PAUSED"}(r||(r={})),e.STATUS=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0);e.Uploader=r.default;var o=n(10);e.uploaderMultiple=o.default,e.default={Uploader:r.default,uploaderMultiple:o.default}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={debug:!1,config:{retryCount:3,concurrentLimit:3,chunkSize:2097152,checkMD5:!1,forceDirect:!1},putExtra:{fname:null,params:{}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){this.runTask=t,this.queue=[],this.processing=[],this.limit=e}return t.prototype.enqueue=function(t){var e=this;return new Promise((function(n,r){e.queue.push({task:t,resolve:n,reject:r}),e.check()}))},t.prototype.run=function(t){var e=this;this.queue=this.queue.filter((function(e){return e!==t})),this.processing.push(t),this.runTask(t.task).then((function(n){e.processing=e.processing.filter((function(e){return e!==t})),t.resolve(n),e.check()}),(function(e){return t.reject(e)}))},t.prototype.check=function(){var t=this,e=this.processing.length,n=this.limit-e;this.queue.slice(0,n).forEach((function(e,n){t.run(e)}))},t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){},o=function(){function t(t){void 0===t&&(t=!1),this.enabled=window.console&&t,this.enabled&&this.log("Debugging enabled")}return Object.defineProperty(t.prototype,"log",{get:function(){return this.enabled?Function.prototype.bind.call(console.log,console):r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"warn",{get:function(){return this.enabled?Function.prototype.bind.call(console.warn,console):r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"error",{get:function(){return this.enabled?Function.prototype.bind.call(console.error,console):r},enumerable:!0,configurable:!0}),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e){return new Promise((function(n,r){var o=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");o.open(e.method,t),e.onCreate&&e.onCreate(o),e.headers&&Object.keys(e.headers).forEach((function(t){return o.setRequestHeader(t,e.headers[t])})),o.upload.addEventListener("progress",(function(t){t.lengthComputable&&e.onProgress&&e.onProgress({loaded:t.loaded,total:t.total})})),o.onreadystatechange=function(){var t=o.responseText;if(4===o.readyState){if(200!==o.status){var e="xhr request failed, code: "+o.status+";";return t&&(e=e+" response: "+t),void r({code:o.status,message:e,isRequestError:!0})}try{n({data:JSON.parse(t)})}catch(t){r(t)}}},o.send(e.body)}))}},function(t,e,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],u=0,s=i.length;u<s;u++,o++)r[o]=i[u];return r};Object.defineProperty(e,"__esModule",{value:!0});var o=n(8);e.cloneDeep=function(t){return JSON.parse(JSON.stringify(t))},e.getDeep=function(t,e){return e.split(".").reduce((function(t,e){return t&&t[e]}),t)},e.extend=function t(e){void 0===e&&(e={});for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(!n.length)return e;var u=n.shift();return o.default.object(u)?(Object.keys(u).forEach((function(n){var r,i;o.default.object(u[n])?(Object.keys(e).includes(n)||Object.assign(e,((r={})[n]={},r)),t(e[n],u[n])):Object.assign(e,((i={})[n]=u[n],i))})),t.apply(void 0,r([e],n))):e},e.filterParams=function(t){return void 0===t&&(t={}),Object.keys(t).map((function(e){return[e,t[e]]}))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return null!=t?t.constructor:null},o=function(t,e){return Boolean(t&&e&&t instanceof e)},i=function(t){return null==t},u=function(t){return r(t)===Object},s=function(t){return r(t)===String},a=function(t){return Array.isArray(t)},c=function(t){return o(t,NodeList)},f=function(t){return i(t)||(s(t)||a(t)||c(t))&&!t.length||u(t)&&!Object.keys(t).length};e.default={nullOrUndefined:i,object:u,number:function(t){return r(t)===Number&&!Number.isNaN(t)},string:s,boolean:function(t){return r(t)===Boolean},function:function(t){return r(t)===Function},array:a,weakMap:function(t){return o(t,WeakMap)},nodeList:c,element:function(t){return o(t,Element)},textNode:function(t){return r(t)===Text},event:function(t){return o(t,Event)},keyboardEvent:function(t){return o(t,KeyboardEvent)},cue:function(t){return o(t,window.TextTrackCue)||o(t,window.VTTCue)},track:function(t){return o(t,TextTrack)||!i(t)&&s(t.kind)},promise:function(t){return o(t,Promise)},url:function(t){if(o(t,window.URL))return!0;if(!s(t))return!1;var e=t;t.startsWith("http://")&&t.startsWith("https://")||(e="http://"+t);try{return!f(new URL(e).hostname)}catch(t){return!1}},empty:f}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=function(t){return"upload_file_"+t.name+"_size_"+t.size};e.setLocalFileInfo=function(t,e){localStorage.setItem(o(t),JSON.stringify(e))},e.getLocalFileInfo=function(t){return JSON.parse(localStorage.getItem(o(t)))||[]},e.removeLocalFileInfo=function(t){localStorage.removeItem(o(t))},e.isChunkExpired=function(t,e){void 0===e&&(e=24);var n=t+3600*e*1e3;return Date.now()>n},e.getPercent=function(t,e){var n=t/e*100;return{loaded:t,total:e,percent:n=n?Number(n.toFixed(2)):0}},e.getChunks=function(t,e){for(var n=[],r=Math.ceil(t.size/e),o=0;o<r;o++){var i=o*e,u=Math.min(t.size,i+e),s=t.slice(i,u);n.push(s)}return n},e.guid=(r=0,function(t){var e,n=(new Date).getTime().toString(32);for(e=0;e<5;e++)n+=Math.floor(65535*Math.random()).toString(32);return(t||"u_")+n+(r++).toString(32)})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),o=n(1),i=function(){function t(t,e){this.UploadProgress=function(t,e){},this.UploadComplete=function(t){},this.FileUploaded=function(t,e){},this.FileUploadError=function(t,e){},this.uploadUrl=t,this.config=e,this.files=[]}return t.prototype.addFile=function(t,e){var n=this,i={url:this.uploadUrl,config:this.config,file:t,putExtra:e},u=new r.default(i),s=u.uuid,a=u.file,c=u.start,f=u.stop,l=(u.complete,{id:s,name:a.name,type:a.type,loaded:0,total:a.size,percent:0,status:o.STATUS.QUEUED,putExtra:e,start:c.bind(u),stop:f.bind(u)});return this.files.push(l),u.next=function(t){return n.uploadProgress(t,l)},u.complete=function(t){return n.uploaded(t,l)},u.error=function(t){return n.uploadError(t,l)},l},t.prototype.getFile=function(t){return this.files.find((function(e){return e.id==t}))},t.prototype.removeFile=function(t){var e=this.files.findIndex((function(e){return e.id===t}));return e>-1&&(this.files[e].stop(),this.files.splice(e,1),this.start(),!0)},t.prototype.start=function(){var t=this.files.find((function(t){return t.status===o.STATUS.QUEUED||t.status===o.STATUS.STOPPED}));t?(this.stopped=!1,t.start(),t.status=o.STATUS.STARTED):this.UploadComplete(this.files)},t.prototype.stop=function(){this.stopped=!0,this.files.forEach((function(t){t.stop(),t.status===o.STATUS.STARTED&&(t.status=o.STATUS.STOPPED)}))},t.prototype.pause=function(t){var e=this.files.find((function(e){return e.id===t}));return!!e&&(e.status===o.STATUS.STARTED?(e.stop(),e.status=o.STATUS.PAUSED):e.status===o.STATUS.PAUSED&&(this.stop(),e.start(),e.status=o.STATUS.STARTED),!0)},t.prototype.uploadProgress=function(t,e){e.loaded=t.total.loaded,e.total=t.total.total,e.percent=t.total.percent,this.UploadProgress(t,e)},t.prototype.uploaded=function(t,e){e.status=o.STATUS.DONE,this.FileUploaded(t,e),this.start()},t.prototype.uploadError=function(t,e){e.status=o.STATUS.FAILED,this.FileUploadError(t,e)},t}();e.default=i}])}));